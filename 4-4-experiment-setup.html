<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="4.4 Experiment Setup | Forecasting Network Data with R" />
<meta property="og:type" content="book" />







<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="4.4 Experiment Setup | Forecasting Network Data with R">

<title>4.4 Experiment Setup | Forecasting Network Data with R</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#preface">Preface</a><ul>
<li><a href="motivations.html#motivations">Motivations</a></li>
<li><a href="prerequisites.html#prerequisites">Prerequisites</a></li>
<li><a href="conventions.html#conventions">Conventions</a></li>
<li><a href="acknowledgements.html#acknowledgements">Acknowledgements</a></li>
<li><a href="about-the-authors.html#about-the-authors">About the Authors</a></li>
</ul></li>
<li class="has-sub"><a href="1-getting-started.html#getting-started"><span class="toc-section-number">1</span> Getting Started</a><ul>
<li><a href="1-1-introduction.html#introduction"><span class="toc-section-number">1.1</span> Introduction</a></li>
<li class="has-sub"><a href="1-2-network.html#network"><span class="toc-section-number">1.2</span> Network</a><ul>
<li><a href="1-2-network.html#network-fundamentals"><span class="toc-section-number">1.2.1</span> Network: fundamentals</a></li>
<li><a href="1-2-network.html#road-network-and-travel-time-as-a-variable-for-transportation"><span class="toc-section-number">1.2.2</span> Road network and travel time as a variable for transportation</a></li>
</ul></li>
<li class="has-sub"><a href="1-3-forecasting.html#forecasting"><span class="toc-section-number">1.3</span> Forecasting</a><ul>
<li><a href="1-3-forecasting.html#space-time-series-forecasting"><span class="toc-section-number">1.3.1</span> Space-time Series Forecasting</a></li>
<li><a href="1-3-forecasting.html#forecasting-models-of-spatial-network-data"><span class="toc-section-number">1.3.2</span> Forecasting Models of Spatial Network Data</a></li>
</ul></li>
<li class="has-sub"><a href="1-4-forecasting-data-and-methods.html#forecasting-data-and-methods"><span class="toc-section-number">1.4</span> Forecasting Data and Methods</a><ul>
<li><a href="1-4-forecasting-data-and-methods.html#data-description"><span class="toc-section-number">1.4.1</span> Data Description</a></li>
<li><a href="1-4-forecasting-data-and-methods.html#applied-methodologies"><span class="toc-section-number">1.4.2</span> Applied Methodologies</a></li>
</ul></li>
<li><a href="1-5-chapter-summary.html#chapter-summary"><span class="toc-section-number">1.5</span> Chapter Summary</a></li>
</ul></li>
<li><a href="2-exploratory-spatio-temporal-data-analysis.html#exploratory-spatio-temporal-data-analysis"><span class="toc-section-number">2</span> Exploratory Spatio-temporal Data Analysis</a></li>
<li class="has-sub"><a href="3-seasonal-and-trend-decomposition-with-loess-forecasting-model.html#seasonal-and-trend-decomposition-with-loess-forecasting-model"><span class="toc-section-number">3</span> Seasonal and Trend Decomposition with Loess Forecasting Model</a><ul>
<li><a href="3-1-introduction-1.html#introduction-1"><span class="toc-section-number">3.1</span> Introduction</a></li>
<li><a href="3-2-chapter-summary-1.html#chapter-summary-1"><span class="toc-section-number">3.2</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="4-support-vector-regression.html#support-vector-regression"><span class="toc-section-number">4</span> Support Vector Regression</a><ul>
<li><a href="4-1-introduction-2.html#introduction-2"><span class="toc-section-number">4.1</span> Introduction</a></li>
<li><a href="4-2-support-vector-regression-svr.html#support-vector-regression-svr"><span class="toc-section-number">4.2</span> Support Vector Regression (SVR)</a></li>
<li><a href="4-3-svr-to-predict-travel-time-for-urban-road.html#svr-to-predict-travel-time-for-urban-road"><span class="toc-section-number">4.3</span> SVR to Predict Travel Time for Urban Road</a></li>
<li><a href="4-4-experiment-setup.html#experiment-setup"><span class="toc-section-number">4.4</span> Experiment Setup</a></li>
<li><a href="4-5-chapter-summary-2.html#chapter-summary-2"><span class="toc-section-number">4.5</span> Chapter Summary</a></li>
</ul></li>
<li class="has-sub"><a href="5-artificial-neural-network.html#artificial-neural-network"><span class="toc-section-number">5</span> Artificial Neural Network</a><ul>
<li><a href="5-1-introduction-3.html#introduction-3"><span class="toc-section-number">5.1</span> Introduction</a></li>
<li><a href="5-2-chapter-summary-3.html#chapter-summary-3"><span class="toc-section-number">5.2</span> Chapter Summary</a></li>
</ul></li>
<li><a href="6-summing-up.html#summing-up"><span class="toc-section-number">6</span> Summing-up</a></li>
<li><a href="appendix-setting-up-r.html#appendix-setting-up-r">Appendix: setting-up R</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="experiment-setup" class="section level2">
<h2><span class="header-section-number">4.4</span> Experiment Setup</h2>
<p>The first part of the experiment is to train the dataset. The data have been divided into training (80%) and testing (20%) data. Four road links have been aleatory chosen to train the model: IDs 2112, 2061, 473 and 2087. To strategy applied to the model training procedure is composed of 4 steps presented on Figure <a href="4-4-experiment-setup.html#fig:chunk-procedure">4.4</a>.</p>
<div class="figure"><span id="fig:chunk-procedure"></span>
<img src="Images/procedure.png" alt="Model Training Procedure steps." width="361" />
<p class="caption">
Figure 4.4: Model Training Procedure steps.
</p>
</div>
<p>To train the data, the package called caret (short for Classification and Regression Training) has been used. The library provides a set of functions that attempt to streamline the process for creating predictive models.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<p><strong>Step 1: Build a time series SVR Model.</strong></p>
<p>The first step has been used the embed function to rearrange the series in order to build a time series SVR model by means of a temporal autoregressive structure. The moving average uses past forecast errors to forecast future values of the series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(kernlab)  <span class="co"># install if necessary using &#39;install.packages&#39;</span>
<span class="kw">library</span>(caret) <span class="co"># install if necessary using &#39;install.packages&#39;</span>

training  &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;training.rds&quot;</span>) 
testing  &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;testing.rds&quot;</span>)</code></pre></div>
<p>To build the model, we will use a temporal autoregressive structure. We use the embed function to rearrange the series. This means we will forecast the future TT at a single location (Link=2112) as a function of a subset of previous TT observations.</p>
<p>The resulting matrix can be used for one step ahead forecasting by using the first three columns as the independent variables and the fourth column as the dependent variable. In order to perform parameters tuning with k-fold cross-validation, three different embedding dimensions q have been applied: q=3: q=4 and q=5.</p>
<p>We will use the <code>embed</code> function to rearrange the series in this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="dv">3</span> 
data.<span class="dv">2112</span> &lt;-<span class="st"> </span><span class="kw">embed</span>(<span class="dt">x =</span> UJT [,<span class="st">&quot;2112&quot;</span>], <span class="dt">dimension =</span> m<span class="op">+</span><span class="dv">1</span>) <span class="co"># embed: function to rearrange the series</span>
<span class="kw">colnames</span>(data.<span class="dv">2112</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y_t-3&quot;</span>,<span class="st">&quot;y_t-2&quot;</span>,<span class="st">&quot;y_t-1&quot;</span>,<span class="st">&quot;y_t&quot;</span>)</code></pre></div>
<p>The function embeds the time series x into a low-dimensional Euclidean space. This way, it is possible to forecast the future temperature as a function of a subset of previous temperature observations. Each row of the resulting matrix consists of sequences x[t], x[t-1], …, x[t-dimension+1], where t is the original index of x. If x is a matrix, i.e., x contains more than one variable, then x[t] consists of the observation on each variable.</p>
<p>The resulting matrix can be displayed with the funcion <code>head ()</code> whihch returns the first or last parts of the matrix. You will see that each row contains four observations, which are four consecutive TT observations. The first row of the matrix contains the first four observations from UJT[,“2112”] in reverse order, e.g. column 4 is the first observation and column 1 is the 4th observation. In the second row, the first observation is removed from column 4 and the 5th observation is added to column 1. This matrix can be used for one step ahead forecasting by using the first three columns as the independent variables and the fourth column as the dependent variable.</p>
<p>The same procedure could be applied to the other dimensions, i.e. q=4 and q=5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m &lt;-<span class="st"> </span><span class="dv">4</span>
data.2112_d2 &lt;-<span class="st"> </span><span class="kw">embed</span>(<span class="dt">x =</span> UJT [,<span class="st">&quot;2112&quot;</span>], <span class="dt">dimension =</span> m<span class="op">+</span><span class="dv">1</span>) 
<span class="kw">colnames</span>(data.2112_d2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y_t-4&quot;</span> , <span class="st">&quot;y_t-3&quot;</span>,<span class="st">&quot;y_t-2&quot;</span>,<span class="st">&quot;y_t-1&quot;</span>,<span class="st">&quot;y_t&quot;</span>)

m &lt;-<span class="st"> </span><span class="dv">5</span>
data.2112_d3 &lt;-<span class="st"> </span><span class="kw">embed</span>(<span class="dt">x =</span> UJT [,<span class="st">&quot;2112&quot;</span>], <span class="dt">dimension =</span> m<span class="op">+</span><span class="dv">1</span>) 
<span class="kw">colnames</span>(data.2112_d3) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y_t-5&quot;</span> , <span class="st">&quot;y_t-4&quot;</span> , <span class="st">&quot;y_t-3&quot;</span>,<span class="st">&quot;y_t-2&quot;</span>,<span class="st">&quot;y_t-1&quot;</span>,<span class="st">&quot;y_t&quot;</span>)</code></pre></div>
<p>** Step 2: Divide data into training and testing sets.**</p>
<p>The next step is to divide the embedded data into training and testing sets. The subset of training data is used to fit the model and the testing set to estimate model fitness. It should be noted that in temporal data there is a continuity component whereas it is important to take into account the ordering of time.</p>
<p>That said, based on a continuous data series, the first 80% data of the months have to be selected to train the model and the remaining 20% data has been selected to test the model. Hence, the particular training set S= {(Xi,yi), …,(Xi,yi) } has been drawn from the distribution of the random vectors y and X.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## divide data into training and testing sets - Dimension 2
split &lt;-<span class="st"> </span><span class="dv">4143</span> <span class="co"># UJT chosen row to separe training and testing data</span>
yTrain &lt;-<span class="st"> </span>data.<span class="dv">2112</span> [<span class="dv">1</span><span class="op">:</span>split,<span class="dv">1</span>]
XTrain &lt;-<span class="st"> </span>data.<span class="dv">2112</span> [<span class="dv">1</span><span class="op">:</span>split,<span class="op">-</span><span class="dv">1</span>]
yTest &lt;-<span class="st"> </span>data.<span class="dv">2112</span> [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.<span class="dv">2112</span> ),<span class="dv">1</span>]
XTest &lt;-<span class="st"> </span>data.<span class="dv">2112</span> [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.<span class="dv">2112</span> ),<span class="op">-</span><span class="dv">1</span>]

## divide data into training and testing sets - Dimension 2
split_d2 &lt;-<span class="st"> </span><span class="dv">4143</span> <span class="co"># UJT.Chosen row to separe training and testing data</span>
yTrain_d2 &lt;-<span class="st"> </span>data.2112_d2 [<span class="dv">1</span><span class="op">:</span>split,<span class="dv">1</span>]
XTrain_d2 &lt;-<span class="st"> </span>data.2112_d2 [<span class="dv">1</span><span class="op">:</span>split,<span class="op">-</span><span class="dv">1</span>]
yTest_d2 &lt;-<span class="st"> </span>data.2112_d2 [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.2112_d2 ),<span class="dv">1</span>]
XTest_d2 &lt;-<span class="st"> </span>data.2112_d2 [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.2112_d2 ),<span class="op">-</span><span class="dv">1</span>]

## divide data into training and testing sets - Dimension 3
split_d3 &lt;-<span class="st"> </span><span class="dv">4143</span> <span class="co"># UJT.Chosen row to separe training and testing data</span>
yTrain_d3 &lt;-<span class="st"> </span>data.2112_d3 [<span class="dv">1</span><span class="op">:</span>split,<span class="dv">1</span>]
XTrain_d3 &lt;-<span class="st"> </span>data.2112_d3 [<span class="dv">1</span><span class="op">:</span>split,<span class="op">-</span><span class="dv">1</span>]
yTest_d3 &lt;-<span class="st"> </span>data.2112_d3 [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.2112_d3 ),<span class="dv">1</span>]
XTest_d3 &lt;-<span class="st"> </span>data.2112_d3 [(split<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(data.2112_d3 ),<span class="op">-</span><span class="dv">1</span>]</code></pre></div>
<p>** Step 3. Perform parameters tuning with k-fold cross validation.**</p>
<p>To determine the values of the tuning parameters, one approach is to use a <em>resampling</em> to estimate how well the model performs on the training set. There are different types of resampling methods, being <em>k-fold cross-validation</em> one of the most common types. The process must be repeated many times and the performance estimates from each holdout set are averaged into a final overall estimate of model efficacy such that given the training set, the algorithm produces a prediction function f(x)= Փ(xi).</p>
<p>For each parameter combination the model fitness is estimated via resampling and the relationship between the tuning parameters and the model performance is evaluated.</p>
<p>The k-fold cross-validation has been applied as resampling method, with k set to 5. In k-fold cross validation, the data are randomly partitioned into k-folds. Each fold is left out in turn and the remaining k-1 folds are used to train a model and predict its values. The selected model is the one with the best average performance across the k folds. The procedure prevents overfitting to a subset of the training data (Cheng &amp; Haworth, 2019).</p>
<p>The <code>caret</code> package is used to perform the cross validation with a radial basis function kernel applied for parameter tuning. There are two tuning parameters: the radial basis function scale parameter bandwidth α, and the cost value associated with support vectors. Table 2 presents the parameters applied to the study. Moreover, to differentiate the values of the embedding dimension, three different autoregressive orders have been used: q=3; q=4 and q=3.</p>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>For more information, see <a href="http://topepo.github.io/caret/index.html" class="uri">http://topepo.github.io/caret/index.html</a><a href="4-4-experiment-setup.html#fnref3">↩</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="4-3-svr-to-predict-travel-time-for-urban-road.html"><button class="btn btn-default">Previous</button></a>
<a href="4-5-chapter-summary-2.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
